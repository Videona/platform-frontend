!function(){angular.module("app",["ui.router","pascalprecht.translate"]).config(["$stateProvider","$urlRouterProvider","$translateProvider",function(e,r,n){var o;switch(navigator.language.split("-")[0]){case"es":o="es_es";break;case"en":o="en_us";break;default:o="es_es"}n.useSanitizeValueStrategy("escape"),n.preferredLanguage(o),r.otherwise("/"),e.state("home",{url:"/",templateUrl:"pages/home/home.view.html"}).state("login",{url:"/login?:redirect",templateUrl:"pages/login/login.view.html"}).state("register",{url:"/register",templateUrl:"pages/register/register.view.html"}).state("terms",{url:"/terms",templateUrl:"pages/terms/terms.view.html"})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("en_us",{HELLO:"Hello",WORLD:"world",LOADING:"loading...",LOGIN:"Login",REGISTER:"Register",USERNAME:"Username",PASSWORD:"Password",EMAIL:"Email",FORGOTTEN_PASSWORD:"Forgotten password?",LOGIN_ACTION:"Log in",REGISTER_ACTION:"Register",NEXT_ACTION:"Next",WRONG_LOGIN:"Wrong user or password. Please, try again.",WRONG_REGISTER:"Wrong register data. Check it out, and try again, please.",REGISTER_SLOGAN:"Mobile Journalism app for Breaking\n the video editing barrier on mobile",QUESTION_AGE:"How old are you?",ACCEPT_CONDITIONS_1:"I've read and I accept ",CONDITIONS:"the terms of service",ACCEPT_CONDITIONS_2:" of Vimojo",COMPLETED:"Ready!",ERROR_USERNAME_EMPTY:"The field username is empty.",ERROR_USERNAME_MIN_LENGTH:"The username is less than 5 characters long.",ERROR_USERNAME_MAX_LENGTH:"The username is longer than 30 characters long",ERROR_USERNAME_ALREADY_IN_USE:"The username is already in use. Try a new one.",ERROR_PASSWORD_EMPTY:"The field password is empty.",ERROR_PASSWORD_MIN_LENGTH:"The password is less than 5 characters long.",ERROR_PASSWORD_MAX_LENGTH:"The password is longer than 30 characters long",ERROR_EMAIL_EMPTY:"The field email is empty.",ERROR_EMAIL_MIN_LENGTH:"The email is less than 5 characters long.",ERROR_EMAIL_MAX_LENGTH:"The email is longer than 30 characters long",ERROR_EMAIL_NOT_VALID:"The email is not valid.",ERROR_EMAIL_ALREADY_IN_USE:"The email is already in use. Try a new one",ERROR_AGE_EMPTY:"The field age is empty",ERROR_AGE_WRONG:"The age must be valid",ERROR_TERMS_EMPTY:"You must accept the terms and conditions of the service",ERROR_RECAPTCHA_NOT_CHECKED:"This app only is able to be used by humans. Aren't you human?"})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("es_es",{HELLO:"Hola",WORLD:"mundo",LOADING:"cargando...",LOGIN:"Acceder",REGISTER:"Registro",USERNAME:"Usuario",PASSWORD:"Contraseña",EMAIL:"Correo electrónico",FORGOTTEN_PASSWORD:"¿Has olvidado tu contraseña?",LOGIN_ACTION:"Inicia sesión",REGISTER_ACTION:"Regístrate",NEXT_ACTION:"Siguiente",WRONG_LOGIN:"Usuario o contraseña incorrectos. Inténtalo de nuevo, por favor.",WRONG_REGISTER:"Los datos de registro son incorrectos. Revísalos, e inténtalo de nuevo, por favor.",REGISTER_SLOGAN:"Aplicación de periodismo móvil\nRompiendo la barrera de edición en móvil.",QUESTION_AGE:"¿Cuántos años tienes?",ACCEPT_CONDITIONS_1:"He leído, entiendo y acepto ",CONDITIONS:"las condiciones del servicio",ACCEPT_CONDITIONS_2:" de Vimojo",COMPLETED:"¡Listo!",ERROR_USERNAME_EMPTY:"El nombre de usuario no puede estar vacío.",ERROR_USERNAME_MIN_LENGTH:"El nombre de usuario necesita ser mas largo.",ERROR_USERNAME_MAX_LENGTH:"El nombre de usuario necesita ser menos largo",ERROR_USERNAME_ALREADY_IN_USE:"El nombre de usuario ya está en uso. Prueba con uno nuevo.",ERROR_PASSWORD_EMPTY:"La contraseña no puede estar vacía.",ERROR_PASSWORD_MIN_LENGTH:"La contraseña necesita ser mas larga.",ERROR_PASSWORD_MAX_LENGTH:"La contraseña necesita ser menos larga.",ERROR_EMAIL_EMPTY:"El email no puede estar vacío.",ERROR_EMAIL_MIN_LENGTH:"El email necesita ser mas largo.",ERROR_EMAIL_MAX_LENGTH:"El email necesita ser menos largo.",ERROR_EMAIL_NOT_VALID:"El email no es válido.",ERROR_EMAIL_ALREADY_IN_USE:"El email ya está en uso. Prueba con uno nuevo.",ERROR_AGE_EMPTY:"La edad no puede estar vacía.",ERROR_AGE_WRONG:"La edad tiene que ser válida.",ERROR_TERMS_EMPTY:"Tienes que aceptar los términos y condiciones de uso.",ERROR_RECAPTCHA_NOT_CHECKED:"En esta aplicación solo aceptamos humanos ¿Acaso eres un robot?"})}])}(),function(){angular.module("app").factory("api",["$http",function(e){var r={url:"http://localhost:3000",token:"",get:function(e,r){return n("GET",e,null,r)},post:function(e,r,o){return n("POST",e,r,o)},del:function(e,r,o){return n("DELETE",e,r,o)},setToken:function(e){void 0!==e&&(r.token=e)}};return r;function n(n,a,t,s){var i={method:n,headers:{},url:a};return""!==r.token&&(i.headers.authorization="Bearer "+r.token),"POST"!==n&&"DELETE"!==n&&"PUT"!==n&&"PATCH"!==n||(i.headers["Content-Type"]="application/x-www-form-urlencoded",i.transformRequest=o,i.data=t),e(i).then(function(e){!function(e,r){var n=e.data,o=e.status,a=e.headers,t=e.config;"function"==typeof r&&r(n,o,a,t)}(e,s)}).catch(function(e){!function(e,r){console.log(e);var n=e.data,o=e.status,a=e.headers,t=e.config;console.error("Error "+o+" in HTTP request"),"function"==typeof r&&r(n,o,a,t)}(e,s)})}function o(e){var r=[],n=Object.keys(e),o=Object.values(e);for(let e=0;e<=n.length;e+=1)r.push(encodeURIComponent(n[e])+"="+encodeURIComponent(o[e]));return r.join("&")}}])}(),function(){angular.module("app").factory("session",["api",function(e){var r={id:-1,name:"",email:"",role:"",verified:!1,token:null,set:n,get:a,logout:t,save:o};return a(),r;function n(n){var a;r.id=n._id||n.id||-1,r.name=n.name||"",r.email=n.email||"",r.role=n.role||"",r.verified=n.verified||!1,n.token&&(a=n.token,r.token=a,e.setToken(a),o()),o()}function o(e){var n=e;void 0===n&&(delete(n=JSON.parse(JSON.stringify(r))).set,delete n.get,delete n.logout,delete n.save),localStorage.setItem("session",JSON.stringify(n))}function a(){var e=JSON.parse(localStorage.getItem("session"));null!==e?n(e):(console.warn("There was no session stored. Logout forzed."),t())}function t(){console.warn("Clossing session..."),r.id=-1,r.name="",r.email="",r.role="",r.verified=!1,localStorage.removeItem("session")}}])}(),function(){angular.module("app").controller("LoginController",["login","session","$state","$stateParams","$translate",function(e,r,n,o,a){var t=this;t.service=e,t.username="",t.password="",t.error="",t.loading=!1,t.submit=function(){""!==t.username&&""!==t.password?(t.loading=!0,t.error=null,console.log("Submiting..."),t.service.login(t.username,t.password,s)):t.error=a.instant("WRONG_LOGIN")},r.id>0&&(console.log("Found a session! Redirecting..."),n.go(o.redirect||"home"));function s(e){t.loading=!1,e?(console.log("Logged in! Redirecting..."),n.go(o.redirect||"home")):(console.log("Bad username or password..."),t.error=a.instant("WRONG_LOGIN"))}}])}(),function(){angular.module("app").factory("login",["api","session",function(e,r){var n={login:function(o,a,t){var s={email:o,password:a};return n.pending=!0,e.post(e.url+"/login",s,function(e,o){n.pending=!1;var a=!1;o>=400?(console.error("Error while logging in"),a=!1):(a=!0,r.set(e)),"function"==typeof t?t(a,e):console.warn("No callback specified for login.")})},pending:!1};return n}])}(),function(){angular.module("app").controller("RegisterController",["register","login","session","$state","$stateParams","$translate",function(e,r,n,o,a,t){var s=this;s.service=e,s.username="",s.email="",s.password="",s.age="",s.terms=!1,s.error=[],s.loading=!1,s.activeView={credentials:!0,terms:!1},s.validateRegister=function(){var e;s.loading=!0,s.error=null,e=function(e){e?s.loading=!1:s.service.validateUsernameAndEmail(s.username,s.email,i)},s.error=[],""===s.username?s.error.push(t.instant("ERROR_USERNAME_EMPTY")):s.username.length<5?s.error.push(t.instant("ERROR_USERNAME_MIN_LENGTH")):s.username.length>30&&s.error.push(t.instant("ERROR_USERNAME_MAX_LENGTH")),""===s.password?s.error.push(t.instant("ERROR_PASSWORD_EMPTY")):s.password.length<5?s.error.push(t.instant("ERROR_PASSWORD_MIN_LENGTH")):s.password.length>30&&s.error.push(t.instant("ERROR_PASSWORD_MAX_LENGTH")),""===s.email?s.error.push(t.instant("ERROR_EMAIL_EMPTY")):s.email.length<5?s.error.push(t.instant("ERROR_EMAIL_MIN_LENGTH")):s.email.length>30?s.error.push(t.instant("ERROR_EMAIL_MAX_LENGTH")):/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/.test(s.email)||s.error.push(t.instant("ERROR_EMAIL_NOT_VALID")),0===s.error.length?e(!1):e(!0)},s.submit=function(){s.error=[],function(e){s.error=[];var r=window.grecaptcha.getResponse();s.terms||s.error.push(t.instant("ERROR_TERMS_EMPTY")),r||s.error.push(t.instant("ERROR_CAPTCHA")),0===s.error.length?e(!0):e(!1)}(function(e){e&&(""!==s.username&&""!==s.password?(s.loading=!0,s.service.register(s.username,s.email,s.password,s.age,l)):s.error.push(t.instant("WRONG_REGISTER")))})},n.id>0&&o.go(a.redirect||"home");function i(e){s.loading=!1,e?(s.activeView.credentials=!1,s.activeView.terms=!0,window.grecaptcha.render(document.getElementById("recaptcha"))):s.error.push(t.instant("ERROR_EMAIL_ALREADY_IN_USE"))}function l(e){s.loading=!1,e?(s.loading=!0,r.login(s.email,s.password,function(e){s.loading=!1,e?o.go(a.redirect||"home"):(s.error.push(t.instant("WRONG_LOGIN")),o.go("login"))})):s.error.push(t.instant("WRONG_REGISTER"))}}])}(),function(){angular.module("app").factory("register",["api",function(e){var r={validateUsernameAndEmail:function(r,n,o){e.get(e.url+"/user/exist?name="+r+"&email="+n,function(e,r){var n=!0;r>=400&&(console.error("Error while registering"),n=!1),console.log(e,r),o(n,e)})},register:function(n,o,a,t,s){var i={name:n,email:o,password:a,age:t};r.pending=!0,e.post(e.url+"/user",i,function(e,n){r.pending=!1;var o=!0;n>=400&&(console.error("Error while registering"),o=!1),s(o,e)})},pending:!1};return r}])}();