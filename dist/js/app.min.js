!function(){angular.module("app",["ui.router","pascalprecht.translate"]).config(["$stateProvider","$urlRouterProvider","$translateProvider",function(e,o,n){var r;switch(navigator.language.split("-")[0]){case"es":r="es_es";break;case"en":r="en_us";break;default:r="es_es"}n.useSanitizeValueStrategy("escape"),n.preferredLanguage(r),o.otherwise("/"),e.state("home",{url:"/",templateUrl:"pages/home/view.html"}).state("login",{url:"/login?:redirect",templateUrl:"pages/login/login.view.html"}).state("register",{url:"/register",templateUrl:"pages/register/view.html"})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("en_us",{HELLO:"Hello",WORLD:"world",LOADING:"loading...",LOGIN:"Login",REGISTER:"Register",USERNAME:"Username",PASSWORD:"Password",EMAIL:"Email",FORGOTTEN_PASSWORD:"Forgotten password?",LOGIN_ACTION:"Log in",REGISTER_ACTION:"Create account",WRONG_LOGIN:"Wrong user or password. Please, try again.",WRONG_REGISTER:"Wrong register data. Check it out, and try again, please."})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("es_es",{HELLO:"Hola",WORLD:"mundo",LOADING:"cargando...",LOGIN:"Acceder",REGISTER:"Registro",USERNAME:"Usuario",PASSWORD:"Contraseña",EMAIL:"Correo electrónico",FORGOTTEN_PASSWORD:"¿Has olvidado tu contraseña?",LOGIN_ACTION:"Inicia sesión",REGISTER_ACTION:"Crear cuenta",WRONG_LOGIN:"Usuario o contraseña incorrectos. Inténtalo de nuevo, por favor.",WRONG_REGISTER:"Los datos de registro son incorrectos. Revísalos, e inténtalo de nuevo, por favor."})}])}(),function(){angular.module("app").factory("api",["$http",function(e){var o={url:"http://localhost:3000",token:"",get:function(e,o){return n("GET",e,null,o)},post:function(e,o,r){return n("POST",e,o,r)},del:function(e,o,r){return n("DELETE",e,o,r)},setToken:function(e){void 0!==e&&(o.token=e)}};return o;function n(n,t,a,i){var s={method:n,headers:{},url:t};return""!==o.token&&(s.headers.authorization="Bearer "+o.token),"POST"!==n&&"DELETE"!==n&&"PUT"!==n&&"PATCH"!==n||(s.headers["Content-Type"]="application/x-www-form-urlencoded",s.transformRequest=r,s.data=a),e(s).then(function(e){!function(e,o){var n=e.data,r=e.status,t=e.headers,a=e.config;"function"==typeof o&&o(n,r,t,a)}(e,i)}).catch(function(e){!function(e,o){console.log(e);var n=e.data,r=e.status,t=e.headers,a=e.config;console.error("Error "+r+" in HTTP request"),"function"==typeof o&&o(n,r,t,a)}(e,i)})}function r(e){var o=[],n=Object.keys(e),r=Object.values(e);for(let e=0;e<=n.length;e+=1)o.push(encodeURIComponent(n[e])+"="+encodeURIComponent(r[e]));return o.join("&")}}])}(),function(){angular.module("app").factory("session",["api",function(e){var o={id:-1,name:"",email:"",role:"",verified:!1,token:null,set:n,get:t,logout:a,save:r};return t(),o;function n(n){o.id=n.id||-1,o.name=n.name||"",o.email=n.email||"",o.role=n.role||"",o.verified=n.verified||!1,n.token&&(t=n.token,o.token=t,e.setToken(t),r());var t;r()}function r(e){var n=e;void 0===n&&(delete(n=JSON.parse(JSON.stringify(o))).set,delete n.get,delete n.logout,delete n.save),localStorage.setItem("session",JSON.stringify(n))}function t(){var e=JSON.parse(localStorage.getItem("session"));null!==e?n(e):(console.warn("There was no session stored. Logout forzed."),a())}function a(){console.warn("Clossing session..."),o.id=-1,o.name="",o.email="",o.role="",o.verified=!1,localStorage.removeItem("session")}}])}(),function(){angular.module("app").controller("LoginController",["login","session","$state","$stateParams","$translate",function(e,o,n,r,t){var a=this;a.service=e,a.username="",a.password="",a.error="",a.loading=!1,a.submit=function(){""!==a.username&&""!==a.password?(a.loading=!0,a.error=null,console.log("Submiting..."),a.service.login(a.username,a.password,i)):a.error=t.instant("WRONG_LOGIN")},o.id>0&&(console.log("Found a session! Redirecting..."),n.go(r.redirect||"home"));function i(e){a.loading=!1,e?(console.log("Logged in! Redirecting..."),n.go(r.redirect||"home")):(console.log("Bad username or password..."),a.error=t.instant("WRONG_LOGIN"))}}])}(),function(){angular.module("app").factory("login",["api","session",function(e,o){var n={login:function(r,t,a){var i={email:r,password:t};return n.pending=!0,e.post(e.url+"/login",i,function(e,r){n.pending=!1;var t=!1;r>=400?(console.error("Error while logging in"),t=!1):(t=!0,o.set(e)),"function"==typeof a?a(t,e):console.warn("No callback specified for login.")})},pending:!1};return n}])}(),function(){angular.module("app").controller("RegisterController",["register","login","session","$state","$stateParams","$translate",function(e,o,n,r,t,a){var i=this;i.service=e,i.username="",i.email="",i.password="",i.error="",i.loading=!1,i.submit=function(){""!==i.username&&""!==i.password?(i.loading=!0,i.error=null,console.log("Submiting..."),i.service.register(i.username,i.email,i.password,s)):i.error=a.instant("WRONG_REGISTER")},n.id>0&&(console.log("Found a session! Redirecting..."),r.go(t.redirect||"home"));function s(e){i.loading=!1,e?(i.loading=!0,console.log("Registered! Logging in..."),o.login(i.username,i.password,function(e){i.loading=!1,e?r.go(t.redirect||"home"):(i.error="Login error. Please, try again...",r.go("login"))})):(console.log("Bad username, email or password..."),i.error=a.instant("WRONG_REGISTER"))}}])}(),function(){angular.module("app").factory("register",["api",function(e){var o={register:function(n,r,t,a){var i={name:n,email:r,password:t};o.pending=!0,e.post(e.url+"/user",i,function(e,n){o.pending=!1;var r=!0;n>=400&&(console.error("Error while registering"),r=!1),a(r,e)})},pending:!1};return o}])}();